{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{BK7m:function(t,n,e){\"use strict\";function l(t){return null!=t&&\"object\"==typeof t&&1===t.nodeType}function i(t,n){return(!n||\"hidden\"!==t)&&\"visible\"!==t&&\"clip\"!==t}function o(t,n){if(t.clientHeight<t.scrollHeight||t.clientWidth<t.scrollWidth){var e=getComputedStyle(t,null);return i(e.overflowY,n)||i(e.overflowX,n)}return!1}function r(t,n,e,l,i,o,r,u){return o<t&&r>n||o>t&&r<n?0:o<=t&&u<=e||r>=n&&u>=e?o-t-l:r>n&&u<e||o<t&&u>e?r-n+i:0}var u=function(t,n){var e=n.scrollMode,i=n.block,u=n.inline,s=n.boundary,c=n.skipOverflowHiddenElements,a=\"function\"==typeof s?s:function(t){return t!==s};if(!l(t))throw new TypeError(\"Invalid target\");for(var h=document.scrollingElement||document.documentElement,f=[],p=t;l(p)&&a(p);){if((p=p.parentNode)===h){f.push(p);break}p===document.body&&o(p)&&!o(document.documentElement)||o(p,c)&&f.push(p)}for(var d=window.visualViewport?visualViewport.width:innerWidth,m=window.visualViewport?visualViewport.height:innerHeight,b=window.scrollX||pageXOffset,g=window.scrollY||pageYOffset,v=t.getBoundingClientRect(),w=v.height,_=v.width,C=v.top,I=v.right,y=v.bottom,P=v.left,O=\"start\"===i||\"nearest\"===i?C:\"end\"===i?y:C+w/2,M=\"center\"===u?P+_/2:\"end\"===u?I:P,k=[],x=0;x<f.length;x++){var T=f[x],A=T.getBoundingClientRect(),L=A.height,S=A.width,H=A.top,j=A.right,V=A.bottom,z=A.left;if(\"if-needed\"===e&&C>=0&&P>=0&&y<=m&&I<=d&&C>=H&&y<=V&&P>=z&&I<=j)return k;var E=getComputedStyle(T),N=parseInt(E.borderLeftWidth,10),W=parseInt(E.borderTopWidth,10),F=parseInt(E.borderRightWidth,10),Y=parseInt(E.borderBottomWidth,10),$=0,D=0,G=\"offsetWidth\"in T?T.offsetWidth-T.clientWidth-N-F:0,B=\"offsetHeight\"in T?T.offsetHeight-T.clientHeight-W-Y:0;if(h===T)$=\"start\"===i?O:\"end\"===i?O-m:\"nearest\"===i?r(g,g+m,m,W,Y,g+O,g+O+w,w):O-m/2,D=\"start\"===u?M:\"center\"===u?M-d/2:\"end\"===u?M-d:r(b,b+d,d,N,F,b+M,b+M+_,_),$=Math.max(0,$+g),D=Math.max(0,D+b);else{$=\"start\"===i?O-H-W:\"end\"===i?O-V+Y+B:\"nearest\"===i?r(H,V,L,W,Y+B,O,O+w,w):O-(H+L/2)+B/2,D=\"start\"===u?M-z-N:\"center\"===u?M-(z+S/2)+G/2:\"end\"===u?M-j+F+G:r(z,j,S,N,F+G,M,M+_,_);var R=T.scrollLeft,X=T.scrollTop;O+=X-($=Math.max(0,Math.min(X+$,T.scrollHeight-L+B))),M+=R-(D=Math.max(0,Math.min(R+D,T.scrollWidth-S+G)))}k.push({el:T,top:$,left:D})}return k};function s(t){return t===Object(t)&&0!==Object.keys(t).length}var c,a=function(t,n){var e=!t.ownerDocument.documentElement.contains(t);if(s(n)&&\"function\"==typeof n.behavior)return n.behavior(e?[]:u(t,n));if(!e){var l=function(t){return!1===t?{block:\"end\",inline:\"nearest\"}:s(t)?t:{block:\"start\",inline:\"nearest\"}}(n);return function(t,n){void 0===n&&(n=\"auto\");var e=\"scrollBehavior\"in document.body.style;t.forEach((function(t){var l=t.el,i=t.top,o=t.left;l.scroll&&e?l.scroll({top:i,left:o,behavior:n}):(l.scrollTop=i,l.scrollLeft=o)}))}(u(t,l),l.behavior)}},h=function(){return c||(c=\"performance\"in window?performance.now.bind(performance):Date.now),c()};n.a=function(t,n){var e=n||{};return function(t){return t&&!t.behavior||\"smooth\"===t.behavior}(e)?a(t,{block:e.block,inline:e.inline,scrollMode:e.scrollMode,boundary:e.boundary,behavior:function(t){return Promise.all(t.reduce((function(t,n){var l=n.el,i=n.left,o=n.top,r=l.scrollLeft,u=l.scrollTop;return r===i&&u===o?t:t.concat([new Promise((function(t){return function(t,n,e,l,i,o){var r,u;void 0===l&&(l=600),void 0===i&&(i=function(t){return 1+--t*t*t*t*t}),r=t.scrollLeft,u=t.scrollTop,function t(n){var e=h(),l=Math.min((e-n.startTime)/n.duration,1),i=n.ease(l),o=n.startX+(n.x-n.startX)*i,r=n.startY+(n.y-n.startY)*i;n.method(o,r),o!==n.x||r!==n.y?requestAnimationFrame((function(){return t(n)})):n.cb()}({scrollable:t,method:function(n,e){t.scrollLeft=n,t.scrollTop=e},startTime:h(),startX:r,startY:u,x:n,y:e,duration:l,ease:i,cb:o})}(l,i,o,e.duration,e.ease,(function(){return t({el:l,left:[r,i],top:[u,o]})}))}))])}),[]))}}):Promise.resolve(a(t,n))}},PRht:function(t,n,e){\"use strict\";var l=e(\"YDfy\"),i=e(\"xVjV\");e(\"/e98\"),e(\"eJQn\"),e.d(n,\"a\",(function(){return o})),e.d(n,\"b\",(function(){return s}));var o=l.rb({encapsulation:0,styles:[['@charset \"UTF-8\";.score[_ngcontent-%COMP%]{position:relative}.score[_ngcontent-%COMP%]::before{content:\"★★★★★\";color:#d8d8d8;font-weight:700}.score[_ngcontent-%COMP%]   .rate[_ngcontent-%COMP%]{position:absolute;overflow:hidden;top:0}.score[_ngcontent-%COMP%]   .rate[_ngcontent-%COMP%]::before{content:\"★★★★★\";color:#ff8a09;font-weight:700}.score[_ngcontent-%COMP%]   .scoreList[_ngcontent-%COMP%]{display:flex;position:absolute;left:0;top:0}.score[_ngcontent-%COMP%]   .scoreList[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:.5em;height:1.5em}']],data:{}});function r(t){return l.Ob(0,[(t()(),l.tb(0,0,null,null,0,\"div\",[],null,[[null,\"mouseenter\"],[null,\"click\"]],(function(t,n,e){var l=!0,i=t.component;return\"mouseenter\"===n&&(l=!1!==(i.rateHover=t.context.$implicit)&&l),\"click\"===n&&(l=!1!==i.rateChange.emit(t.context.$implicit)&&l),l}),null,null))],null,null)}function u(t){return l.Ob(0,[(t()(),l.tb(0,0,null,null,2,\"div\",[[\"class\",\"scoreList\"]],null,null,null,null,null)),(t()(),l.ib(16777216,null,null,1,null,r)),l.sb(2,278528,null,0,i.k,[l.P,l.M,l.q],{ngForOf:[0,\"ngForOf\"]},null)],(function(t,n){t(n,2,0,n.component.scoreList)}),null)}function s(t){return l.Ob(0,[(t()(),l.tb(0,0,null,null,3,\"div\",[[\"class\",\"score\"]],null,[[null,\"mouseleave\"]],(function(t,n,e){var l=!0;return\"mouseleave\"===n&&(l=!1!==(t.component.rateHover=null)&&l),l}),null,null)),(t()(),l.tb(1,0,null,null,0,\"div\",[[\"class\",\"rate\"]],[[4,\"width\",\"em\"]],null,null,null,null)),(t()(),l.ib(16777216,null,null,1,null,u)),l.sb(3,16384,null,0,i.l,[l.P,l.M],{ngIf:[0,\"ngIf\"]},null)],(function(t,n){t(n,3,0,!n.component.readonly)}),(function(t,n){var e=n.component;t(n,1,0,e.rateHover||e.rate)}))}},TgOs:function(t,n,e){\"use strict\";var l=e(\"YDfy\"),i=e(\"xVjV\");e(\"p1YQ\"),e.d(n,\"a\",(function(){return o})),e.d(n,\"b\",(function(){return p}));var o=l.rb({encapsulation:0,styles:[[\"[_nghost-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}button[_ngcontent-%COMP%]{padding:.2rem .5rem;margin-left:.2rem;border-radius:4px}button[_ngcontent-%COMP%]:disabled{opacity:.5}\"]],data:{}});function r(t){return l.Ob(0,[(t()(),l.tb(0,0,null,null,1,\"span\",[],null,null,null,null,null)),(t()(),l.Mb(-1,null,[\"...\"]))],null,null)}function u(t){return l.Ob(0,[(t()(),l.tb(0,0,null,null,4,null,null,null,null,null,null,null)),(t()(),l.tb(1,0,null,null,1,\"button\",[],null,[[null,\"click\"]],(function(t,n,e){var l=!0;return\"click\"===n&&(l=!1!==t.component.pageIndexChange.emit(0)&&l),l}),null,null)),(t()(),l.Mb(-1,null,[\"1\"])),(t()(),l.ib(16777216,null,null,1,null,r)),l.sb(4,16384,null,0,i.l,[l.P,l.M],{ngIf:[0,\"ngIf\"]},null),(t()(),l.ib(0,null,null,0))],(function(t,n){t(n,4,0,!n.component.pageList.includes(1))}),null)}function s(t){return l.Ob(0,[(t()(),l.tb(0,0,null,null,1,\"button\",[],[[2,\"active\",null]],[[null,\"click\"]],(function(t,n,e){var l=!0;return\"click\"===n&&(l=!1!==t.component.pageIndexChange.emit(t.context.$implicit)&&l),l}),null,null)),(t()(),l.Mb(1,null,[\"\",\"\"]))],null,(function(t,n){t(n,0,0,n.component.pageIndex===n.context.$implicit),t(n,1,0,n.context.$implicit+1)}))}function c(t){return l.Ob(0,[(t()(),l.tb(0,0,null,null,1,\"span\",[],null,null,null,null,null)),(t()(),l.Mb(-1,null,[\"...\"]))],null,null)}function a(t){return l.Ob(0,[(t()(),l.tb(0,0,null,null,4,null,null,null,null,null,null,null)),(t()(),l.ib(16777216,null,null,1,null,c)),l.sb(2,16384,null,0,i.l,[l.P,l.M],{ngIf:[0,\"ngIf\"]},null),(t()(),l.tb(3,0,null,null,1,\"button\",[],null,[[null,\"click\"]],(function(t,n,e){var l=!0,i=t.component;return\"click\"===n&&(l=!1!==i.pageIndexChange.emit(i.pageCount-1)&&l),l}),null,null)),(t()(),l.Mb(4,null,[\"\",\"\"]))],(function(t,n){var e=n.component;t(n,2,0,!e.pageList.includes(e.pageCount-2))}),(function(t,n){t(n,4,0,n.component.pageCount)}))}function h(t){return l.Ob(0,[(t()(),l.tb(0,0,null,null,10,null,null,null,null,null,null,null)),(t()(),l.tb(1,0,null,null,1,\"button\",[],[[8,\"disabled\",0]],[[null,\"click\"]],(function(t,n,e){var l=!0,i=t.component;return\"click\"===n&&(l=!1!==i.pageIndexChange.emit(i.pageIndex-1)&&l),l}),null,null)),(t()(),l.Mb(-1,null,[\"<\"])),(t()(),l.ib(16777216,null,null,1,null,u)),l.sb(4,16384,null,0,i.l,[l.P,l.M],{ngIf:[0,\"ngIf\"]},null),(t()(),l.ib(16777216,null,null,1,null,s)),l.sb(6,278528,null,0,i.k,[l.P,l.M,l.q],{ngForOf:[0,\"ngForOf\"]},null),(t()(),l.ib(16777216,null,null,1,null,a)),l.sb(8,16384,null,0,i.l,[l.P,l.M],{ngIf:[0,\"ngIf\"]},null),(t()(),l.tb(9,0,null,null,1,\"button\",[],[[8,\"disabled\",0]],[[null,\"click\"]],(function(t,n,e){var l=!0,i=t.component;return\"click\"===n&&(l=!1!==i.pageIndexChange.emit(i.pageIndex+1)&&l),l}),null,null)),(t()(),l.Mb(-1,null,[\">\"]))],(function(t,n){var e=n.component;t(n,4,0,!e.pageList.includes(0)),t(n,6,0,e.pageList),t(n,8,0,!e.pageList.includes(e.pageCount-1))}),(function(t,n){var e=n.component;t(n,1,0,0===e.pageIndex),t(n,9,0,e.pageIndex===e.pageCount-1)}))}function f(t){return l.Ob(0,[(t()(),l.tb(0,0,null,null,2,null,null,null,null,null,null,null)),(t()(),l.ib(16777216,null,null,1,null,h)),l.sb(2,16384,null,0,i.l,[l.P,l.M],{ngIf:[0,\"ngIf\"]},null),(t()(),l.ib(0,null,null,0))],(function(t,n){t(n,2,0,n.component.pageList.length>1)}),null)}function p(t){return l.Ob(0,[(t()(),l.ib(16777216,null,null,1,null,f)),l.sb(1,16384,null,0,i.l,[l.P,l.M],{ngIf:[0,\"ngIf\"]},null)],(function(t,n){t(n,1,0,n.component.pageCount)}),null)}},pJbx:function(t,n,e){\"use strict\";e.d(n,\"b\",(function(){return s})),e.d(n,\"a\",(function(){return c}));var l=e(\"idFp\"),i=e(\"AkEC\"),o=e(\"BK7m\"),r=e(\"/e98\"),u=function(t){return t[t.News=0]=\"News\",t[t.History=1]=\"History\",t}({}),s=function(t){return t[t.Unknown=0]=\"Unknown\",t[t.RateInvalid=1]=\"RateInvalid\",t[t.CommentInvalid=2]=\"CommentInvalid\",t[t.AllInvalid=3]=\"AllInvalid\",t[t.Failed=4]=\"Failed\",t}({}),c=function(){function t(t,n,e,l,i){var o=this;this.domSanitizer=t,this.authService=n,this.commentService=e,this.auth=l,this.fb=i,this.content=this.fb.control(\"\",r.v.required),this.score=this.fb.control(0,r.v.min(.5)),this.submitted=this.fb.control(null),this.commentGroup=this.fb.group({content:this.content,score:this.score,submitted:this.submitted}),this.loading=!0,this.loadCount=0,this.info$=this.auth.info$,this.CommentType=u,this.CommentError=s,this.haveNewComment=!1,this.total={},this.select=u.News,this.page={index:0,size:20},this.login=function(){return o.authService.login()},this.logout=function(){return o.authService.logout()},this.register=function(){return o.authService.register()}}return Object.defineProperty(t.prototype,\"publicAPI\",{get:function(){return this.commentService.publicAPI(this.appID)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"userAPI\",{get:function(){return this.commentService.userAPI(this.appID)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"firstPageSize\",{get:function(){return this.total[this.select]%this.page.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"selectVersion\",{get:function(){return this.select===u.News?{version:this.version}:{exclude_version:this.version}},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.init()},t.prototype.init=function(){return l.__awaiter(this,void 0,void 0,(function(){return l.__generator(this,(function(t){switch(t.label){case 0:return[4,this.getCount()];case 1:return t.sent(),this.selectChange(u.News),[2]}}))}))},t.prototype.getCount=function(){return l.__awaiter(this,void 0,void 0,(function(){var t;return l.__generator(this,(function(n){switch(n.label){case 0:return[4,this.publicAPI.list({limit:1,version:this.version})];case 1:return t=n.sent(),this.total[u.News]=t.count,[4,this.publicAPI.list({limit:1,exclude_version:this.version})];case 2:return t=n.sent(),this.total[u.History]=t.count,[2]}}))}))},t.prototype.selectChange=function(t){return l.__awaiter(this,void 0,void 0,(function(){return l.__generator(this,(function(n){switch(n.label){case 0:return this.select=t,[4,this.pageChange(0)];case 1:return n.sent(),[2]}}))}))},t.prototype.pageChange=function(t){return l.__awaiter(this,void 0,void 0,(function(){return l.__generator(this,(function(n){switch(n.label){case 0:return this.page.index=t,[4,this.getComments()];case 1:return n.sent(),this.commentTop(),[2]}}))}))},t.prototype.getComments=function(){return l.__awaiter(this,void 0,void 0,(function(){var t,n,e,o,r,s,c;return l.__generator(this,(function(a){switch(a.label){case 0:return 0!==this.total[this.select]?[3,2]:[4,this.getCount()];case 1:if(a.sent(),0===this.total[this.select])return this.list=[],this.loading=!1,[2];a.label=2;case 2:return this.loadCount++,t=this.loadCount,this.loading=!0,n=l.__assign({limit:20,offset:(Math.ceil(this.total[this.select]/this.page.size)-(this.page.index+1))*this.page.size},this.selectVersion),[4,this.publicAPI.list(n)];case 3:return e=a.sent(),this.firstPageSize>0?n.offset>0?(n.offset-=this.page.size,n.offset<0&&(n.offset=0),[4,this.publicAPI.list(n)]):[3,5]:[3,6];case 4:o=a.sent(),e.items=l.__spread(e.items,o.items),a.label=5;case 5:0!==this.page.index&&(e.items=e.items.slice(this.page.size-this.firstPageSize)),e.items.slice(0,this.page.size),a.label=6;case 6:return 0!==this.page.index?[3,10]:[4,this.publicAPI.list(l.__assign({top:!0},this.selectVersion))];case 7:return(r=a.sent()).items.forEach((function(t){t.isHot=!0;var n=e.items.findIndex((function(n){return n.id===t.id}));-1!==n&&e.items.splice(n,1)})),e.items=l.__spread(r.items,e.items),[4,this.info$.pipe(Object(i.a)()).toPromise()];case 8:return(s=a.sent())?(console.log(s),[4,this.userAPI.list(l.__assign({app_id:this.appID},this.selectVersion))]):[3,10];case 9:c=a.sent(),this.select===u.News&&(this.own=c.items[0]),e.items=l.__spread(c.items,e.items.filter((function(t){return t.commenter!==s.uid}))),a.label=10;case 10:return this.loadCount===t&&(this.list=e.items,this.loading=!1),[2]}}))}))},t.prototype.submitComment=function(){return l.__awaiter(this,void 0,void 0,(function(){var t,n=this;return l.__generator(this,(function(e){switch(e.label){case 0:if((t=this.commentGroup.get(\"content\")).setValue(t.value.trim()),this.commentGroup.markAllAsTouched(),this.commentGroup.invalid)return[2];e.label=1;case 1:return e.trys.push([1,4,,5]),this.commentGroup.disable(),[4,this.userAPI.post({app_id:this.appID,content:this.content.value,score:this.score.value})];case 2:return e.sent(),this.haveNewComment=!0,[4,this.selectChange(u.News)];case 3:return e.sent(),setTimeout((function(){return n.haveNewComment=!1}),1e3),this.commentGroup.reset(),[3,5];case 4:return e.sent(),this.commentGroup.setErrors({error:!0}),this.commentGroup.enable(),[3,5];case 5:return[2]}}))}))},t.prototype.thumbUpClick=function(t){return l.__awaiter(this,void 0,void 0,(function(){var n,e;return l.__generator(this,(function(l){switch(l.label){case 0:return[4,this.info$.pipe(Object(i.a)()).toPromise()];case 1:return n=l.sent(),-1!==(e=t.likes.findIndex((function(t){return t.liker===n.uid})))?[3,3]:[4,this.commentService.like(t.id).toPromise()];case 2:return l.sent(),t.likes.push({liker:n.uid}),[3,5];case 3:return[4,this.commentService.dislike(t.id).toPromise()];case 4:l.sent(),t.likes.splice(e,1),l.label=5;case 5:return[2]}}))}))},t.prototype.commentTop=function(){Object(o.a)(this.commentRef.nativeElement,{scrollMode:\"if-needed\",block:\"start\"})},t.prototype.scrollToTop=function(){Object(o.a)(document.querySelector(\".appInfo\"),{block:\"start\"})},t.prototype.likeByMe=function(t,n){return t.find((function(t){return t.liker===n}))},t}()}}]);","extractedComments":[]}