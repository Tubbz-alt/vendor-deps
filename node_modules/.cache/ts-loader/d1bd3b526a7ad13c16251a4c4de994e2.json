{"remainingRequest":"/home/myml/Src/deepin/deepin-manual/src/manual-web/node_modules/thread-loader/dist/cjs.js!/home/myml/Src/deepin/deepin-manual/src/manual-web/node_modules/ts-loader/index.js??ref--13-2!/home/myml/Src/deepin/deepin-manual/src/manual-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/myml/Src/deepin/deepin-manual/src/manual-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/myml/Src/deepin/deepin-manual/src/manual-web/src/components/Content.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/home/myml/Src/deepin/deepin-manual/src/manual-web/src/components/Content.vue","mtime":1540289763988},{"path":"/home/myml/Src/deepin/deepin-manual/src/manual-web/node_modules/cache-loader/dist/cjs.js","mtime":1535964698825},{"path":"/home/myml/Src/deepin/deepin-manual/src/manual-web/node_modules/thread-loader/dist/cjs.js","mtime":1535964700766},{"path":"/home/myml/Src/deepin/deepin-manual/src/manual-web/node_modules/ts-loader/index.js","mtime":1535964694475},{"path":"/home/myml/Src/deepin/deepin-manual/src/manual-web/node_modules/cache-loader/dist/cjs.js","mtime":1535964698825},{"path":"/home/myml/Src/deepin/deepin-manual/src/manual-web/node_modules/vue-loader/lib/index.js","mtime":1538028549491}],"contextDependencies":[],"result":["import Vue from 'vue';\nimport MyPreviewMan from '@/components/Preview-Man.vue';\nimport scrollIntoView from 'smooth-scroll-into-view-if-needed';\nimport { waitImg } from '@/helper/wait-img';\nexport default Vue.extend({\n    components: { MyPreviewMan: MyPreviewMan },\n    props: {\n        html: String,\n    },\n    data: function () {\n        return {\n            currentHeading: '',\n            headingScroll: 0,\n        };\n    },\n    computed: {\n        heading: function () {\n            return this.$store.state.heading;\n        },\n        navWidth: function () {\n            return this.$store.state.navWidth;\n        },\n        previewMan: function () {\n            return this.$store.state.previewMan;\n        },\n        content: function () {\n            // 路由变化 计算属性刷新\n            var _ = this.$route;\n            return this.$refs.content;\n        },\n        hList: function () {\n            return Array.from(this.content.querySelectorAll('h2,h3'));\n        },\n    },\n    watch: {\n        heading: function (val) {\n            this.scrollTo(val);\n        },\n        $route: {\n            immediate: true,\n            handler: function () {\n                var _this = this;\n                var heading = this.$route.query.heading;\n                this.currentHeading = '';\n                Vue.nextTick(function () {\n                    waitImg(_this.content).then(function () {\n                        _this.scrollTo(heading);\n                    });\n                });\n            },\n        },\n    },\n    methods: {\n        scrollTo: function (heading) {\n            var _this = this;\n            if (this.currentHeading === heading) {\n                return;\n            }\n            var el = document.getElementById(heading);\n            if (!el) {\n                el = document.getElementById('h1');\n            }\n            if (el) {\n                this.currentHeading = el.id;\n                this.headingScroll++;\n                scrollIntoView(el, { block: 'start' }).then(function () {\n                    _this.headingScroll--;\n                });\n                this.$store.commit('setHeading', this.currentHeading);\n            }\n        },\n        scroll: function () {\n            if (this.headingScroll != 0) {\n                return;\n            }\n            if (this.previewMan) {\n                this.$store.commit('previewMan', null);\n            }\n            var limit = window.innerHeight / 2;\n            for (var _i = 0, _a = this.hList; _i < _a.length; _i++) {\n                var h = _a[_i];\n                var top = h.getBoundingClientRect().top;\n                if (top > limit) {\n                    break;\n                }\n                this.currentHeading = h.id;\n                if (top >= 0 && top < limit) {\n                    break;\n                }\n            }\n            if (this.currentHeading != this.heading) {\n                this.$store.commit('setHeading', this.currentHeading);\n            }\n        },\n        click: function (e) {\n            switch (e.toElement.nodeName) {\n                case 'IMG': {\n                    var el = e.toElement;\n                    var ext = el.src.slice(el.src.lastIndexOf('.') + 1);\n                    if (['jpg', 'png', 'jpeg'].includes(ext)) {\n                        this.$store.commit('previewImage', el.src);\n                    }\n                    break;\n                }\n                case 'A': {\n                    var el = e.toElement;\n                    var href = el.getAttribute('href');\n                    if (!href) {\n                        return;\n                    }\n                    switch (true) {\n                        // 锚跳转\n                        case href.startsWith('#'): {\n                            var hash_1 = href.slice('#'.length);\n                            var el_1 = this.hList.find(function (heading) { return heading.innerText === hash_1; });\n                            if (el_1) {\n                                this.scrollTo(el_1.id);\n                            }\n                            break;\n                        }\n                        // 弹窗预览\n                        case href.startsWith('dman://'): {\n                            var _a = href.slice('dman://'.length).split('#'), name = _a[0], heading = _a[1];\n                            if (name.startsWith('/')) {\n                                name = name.slice(1);\n                            }\n                            if (this.previewMan &&\n                                this.previewMan.name === name &&\n                                this.previewMan.heading === heading) {\n                                this.$store.commit('previewMan', null);\n                            }\n                            else {\n                                this.$store.commit('previewMan', { name: name, heading: heading, x: e.clientX, y: e.clientY });\n                            }\n                            break;\n                        }\n                    }\n                    break;\n                }\n                default:\n                    if (this.previewMan) {\n                        this.$store.commit('previewMan', null);\n                    }\n            }\n        },\n    },\n});\n",{"version":3,"file":"/home/myml/Src/deepin/deepin-manual/src/manual-web/src/components/Content.vue.ts","sourceRoot":"","sources":["/home/myml/Src/deepin/deepin-manual/src/manual-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/myml/Src/deepin/deepin-manual/src/manual-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/myml/Src/deepin/deepin-manual/src/manual-web/src/components/Content.vue?vue&type=script&lang=ts&"],"names":[],"mappings":"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","sourcesContent":["\n\n\n\n\n\n\n\n\nimport Vue from 'vue';\nimport MyPreviewMan from '@/components/Preview-Man.vue';\nimport scrollIntoView from 'smooth-scroll-into-view-if-needed';\nimport { PreviewMan } from '@/store';\nimport { waitImg } from '@/helper/wait-img';\nexport default Vue.extend({\n  components: { MyPreviewMan },\n  props: {\n    html: String,\n  },\n  data() {\n    return {\n      currentHeading: '',\n      headingScroll: 0,\n    };\n  },\n  computed: {\n    heading(): string {\n      return this.$store.state.heading;\n    },\n    navWidth(): number {\n      return this.$store.state.navWidth;\n    },\n    previewMan(): PreviewMan {\n      return this.$store.state.previewMan;\n    },\n    content(): HTMLDivElement {\n      // 路由变化 计算属性刷新\n      const _ = this.$route;\n      return this.$refs.content as HTMLDivElement;\n    },\n    hList(): Array<HTMLHeadingElement> {\n      return Array.from<HTMLHeadingElement>(this.content.querySelectorAll('h2,h3'));\n    },\n  },\n  watch: {\n    heading(val: string) {\n      this.scrollTo(val);\n    },\n    $route: {\n      immediate: true,\n      handler() {\n        const heading = this.$route.query.heading;\n        this.currentHeading = '';\n        Vue.nextTick(() => {\n          waitImg(this.content).then(() => {\n            this.scrollTo(heading);\n          });\n        });\n      },\n    },\n  },\n  methods: {\n    scrollTo(heading: string) {\n      if (this.currentHeading === heading) {\n        return;\n      }\n      let el = document.getElementById(heading);\n      if (!el) {\n        el = document.getElementById('h1');\n      }\n      if (el) {\n        this.currentHeading = el.id;\n        this.headingScroll++;\n        scrollIntoView(el, { block: 'start' }).then(() => {\n          this.headingScroll--;\n        });\n        this.$store.commit('setHeading', this.currentHeading);\n      }\n    },\n    scroll() {\n      if (this.headingScroll != 0) {\n        return;\n      }\n      if (this.previewMan) {\n        this.$store.commit('previewMan', null);\n      }\n      const limit = window.innerHeight / 2;\n      for (const h of this.hList) {\n        const top = h.getBoundingClientRect().top;\n        if (top > limit) {\n          break;\n        }\n        this.currentHeading = h.id;\n        if (top >= 0 && top < limit) {\n          break;\n        }\n      }\n      if (this.currentHeading != this.heading) {\n        this.$store.commit('setHeading', this.currentHeading);\n      }\n    },\n    click(e: MouseEvent) {\n      switch (e.toElement.nodeName) {\n        case 'IMG': {\n          const el = e.toElement as HTMLImageElement;\n          const ext = el.src.slice(el.src.lastIndexOf('.') + 1);\n          if (['jpg', 'png', 'jpeg'].includes(ext)) {\n            this.$store.commit('previewImage', el.src);\n          }\n          break;\n        }\n        case 'A': {\n          const el = e.toElement as HTMLLinkElement;\n          const href = el.getAttribute('href');\n          if (!href) {\n            return;\n          }\n          switch (true) {\n            // 锚跳转\n            case href.startsWith('#'): {\n              const hash = href.slice('#'.length);\n              const el = this.hList.find(heading => heading.innerText === hash);\n              if (el) {\n                this.scrollTo(el.id);\n              }\n              break;\n            }\n            // 弹窗预览\n            case href.startsWith('dman://'): {\n              let [name, heading] = href.slice('dman://'.length).split('#');\n              if (name.startsWith('/')) {\n                name = name.slice(1);\n              }\n              if (\n                this.previewMan &&\n                this.previewMan.name === name &&\n                this.previewMan.heading === heading\n              ) {\n                this.$store.commit('previewMan', null);\n              } else {\n                this.$store.commit('previewMan', { name, heading, x: e.clientX, y: e.clientY });\n              }\n              break;\n            }\n          }\n          break;\n        }\n        default:\n          if (this.previewMan) {\n            this.$store.commit('previewMan', null);\n          }\n      }\n    },\n  },\n});\n"]}]}