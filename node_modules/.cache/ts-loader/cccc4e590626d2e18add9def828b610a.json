{"remainingRequest":"/home/myml/Src/deepin/deepin-manual/src/manual-web/node_modules/ts-loader/index.js??ref--13-1!/home/myml/Src/deepin/deepin-manual/src/manual-web/node_modules/eslint-loader/index.js??ref--12-0!/home/myml/Src/deepin/deepin-manual/src/manual-web/src/store.ts","dependencies":[{"path":"/home/myml/Src/deepin/deepin-manual/src/manual-web/src/store.ts","mtime":1540289763992},{"path":"/home/myml/Src/deepin/deepin-manual/src/manual-web/node_modules/cache-loader/dist/cjs.js","mtime":1535964698825},{"path":"/home/myml/Src/deepin/deepin-manual/src/manual-web/node_modules/ts-loader/index.js","mtime":1535964694475},{"path":"/home/myml/Src/deepin/deepin-manual/src/manual-web/node_modules/eslint-loader/index.js","mtime":1538208286718}],"contextDependencies":[],"result":["import * as tslib_1 from \"tslib\";\nimport Vue from 'vue';\nimport Vuex from 'vuex';\nimport { fetchFile } from '@/helper/fetch-file';\nimport { renderMan } from '@/helper/render-man.ts';\nVue.use(Vuex);\nexport default new Vuex.Store({\n    state: {\n        lang: '',\n        dict: {},\n        dir: '',\n        list: [],\n        navWidth: 200,\n        heading: '',\n        previewImage: '',\n        previewMan: null,\n        searchResults: {},\n        positions: {},\n    },\n    mutations: {\n        init: function (state, initData) {\n            state.lang = initData[0], state.dict = initData[1], state.dir = initData[2], state.list = initData[3];\n        },\n        // 保存导航栏宽度\n        setNavWidth: function (state, width) {\n            state.navWidth = width;\n        },\n        // 设置当前标题\n        setHeading: function (state, heading) {\n            state.heading = heading;\n        },\n        // 预览大图\n        previewImage: function (state, imgSrc) {\n            if (window.objects) {\n                window.objects.imageViewer.open(imgSrc);\n            }\n            else {\n                state.previewImage = imgSrc;\n            }\n        },\n        // 预览手册\n        previewMan: function (state, payload) {\n            state.previewMan = payload;\n        },\n        // 追加搜索结果\n        addSearchResult: function (state, payload) {\n            var _a;\n            state.searchResults = tslib_1.__assign({}, state.searchResults, (_a = {}, _a[payload.name] = payload.results, _a));\n        },\n        // 清空搜索结果\n        clearSearchResult: function (state) {\n            state.searchResults = {};\n        },\n        // 保存滚动位置\n        savePosition: function (state, position) {\n            var _a;\n            state.positions = tslib_1.__assign({}, state.positions, (_a = {}, _a[position.name] = { x: position.x, y: position.y }, _a));\n        },\n    },\n    actions: {\n        // 初始化\n        init: function (_a) {\n            var commit = _a.commit, dispatch = _a.dispatch;\n            return tslib_1.__awaiter(this, void 0, void 0, function () {\n                var _b, lang, dict, dir, list;\n                return tslib_1.__generator(this, function (_c) {\n                    switch (_c.label) {\n                        case 0:\n                            if (!window.objects) return [3 /*break*/, 2];\n                            return [4 /*yield*/, Promise.all([\n                                    new Promise(function (resolve) { return window.objects.i18n.getLocale(resolve); }),\n                                    new Promise(function (resolve) { return window.objects.i18n.getSentences(resolve); }),\n                                    new Promise(function (resolve) { return window.objects.manual.getSystemManualDir(resolve); }),\n                                    new Promise(function (resolve) { return window.objects.manual.getSystemManualList(resolve); }),\n                                ])];\n                        case 1:\n                            // 本地模式初始化\n                            _b = _c.sent(), lang = _b[0], dict = _b[1], dir = _b[2], list = _b[3];\n                            dispatch('listenSearch');\n                            return [3 /*break*/, 6];\n                        case 2:\n                            // 在线模式初始化\n                            lang = navigator.language.replace('-', '_');\n                            return [4 /*yield*/, fetch('/api/dict.json')\n                                    .then(function (resp) { return resp.json(); })\n                                    .then(function (result) { return result; })];\n                        case 3:\n                            dict = _c.sent();\n                            return [4 /*yield*/, fetch('/api/dir.json')\n                                    .then(function (resp) { return resp.json(); })\n                                    .then(function (result) { return result.path; })];\n                        case 4:\n                            dir = _c.sent();\n                            return [4 /*yield*/, fetch('/api/list.json')\n                                    .then(function (resp) { return resp.json(); })\n                                    .then(function (result) { return result; })];\n                        case 5:\n                            list = _c.sent();\n                            _c.label = 6;\n                        case 6:\n                            if (!['zh_CN', 'en_US'].includes(lang)) {\n                                lang = 'en_US';\n                            }\n                            commit('init', [lang, dict, dir, list]);\n                            return [2 /*return*/];\n                    }\n                });\n            });\n        },\n        // 监听搜索事件\n        listenSearch: function (_a) {\n            var commit = _a.commit;\n            window.objects.search.onContentResult.connect(function (name, titles, heads, contents) {\n                var results = titles.map(function (title, index) {\n                    return {\n                        title: title,\n                        heading: heads[index],\n                        content: contents[index],\n                    };\n                });\n                var payload = { name: name, results: results };\n                commit('addSearchResult', Object.freeze(payload));\n            });\n        },\n        // 获取应用目录路径\n        getAppPath: function (_a, name) {\n            var state = _a.state;\n            if (window.objects) {\n                return \"file://\" + state.dir + \"/\" + name + \"/\" + state.lang;\n            }\n            else {\n                return state.dir + \"/\" + name + \"/\" + state.lang;\n            }\n        },\n        // 获取应用信息\n        getAppInfo: function (_a, name) {\n            var dispatch = _a.dispatch;\n            return tslib_1.__awaiter(this, void 0, void 0, function () {\n                var path, text, header, _b, title, icon;\n                return tslib_1.__generator(this, function (_c) {\n                    switch (_c.label) {\n                        case 0: return [4 /*yield*/, dispatch('getAppPath', name)];\n                        case 1:\n                            path = _c.sent();\n                            return [4 /*yield*/, fetchFile(path + \"/index.md\")];\n                        case 2:\n                            text = _c.sent();\n                            header = text.slice('# '.length, text.indexOf('\\n'));\n                            _b = header.split('|'), title = _b[0], icon = _b[1];\n                            icon = path + \"/\" + icon;\n                            return [2 /*return*/, { name: name, icon: icon, title: title, path: path }];\n                    }\n                });\n            });\n        },\n        // 渲染md文件\n        renderApp: function (_a, name) {\n            var dispatch = _a.dispatch;\n            return tslib_1.__awaiter(this, void 0, void 0, function () {\n                var path, raw, _b, _c;\n                return tslib_1.__generator(this, function (_d) {\n                    switch (_d.label) {\n                        case 0: return [4 /*yield*/, dispatch('getAppPath', name)];\n                        case 1:\n                            path = _d.sent();\n                            return [4 /*yield*/, fetchFile(path + \"/index.md\")];\n                        case 2:\n                            raw = _d.sent();\n                            _c = (_b = Object).freeze;\n                            return [4 /*yield*/, renderMan({ raw: raw, path: path })];\n                        case 3: return [2 /*return*/, _c.apply(_b, [_d.sent()])];\n                    }\n                });\n            });\n        },\n        // 打开外部链接\n        openLink: function (_a, link) {\n            if (window.objects) {\n                window.objects.manual.openExternalLink(link);\n            }\n            else {\n                window.open(link);\n            }\n        },\n    },\n});\n",{"version":3,"file":"/home/myml/Src/deepin/deepin-manual/src/manual-web/src/store.ts","sourceRoot":"","sources":["/home/myml/Src/deepin/deepin-manual/src/manual-web/node_modules/eslint-loader/index.js??ref--12-0!/home/myml/Src/deepin/deepin-manual/src/manual-web/src/store.ts"],"names":[],"mappings":";AAAA,OAAO,GAAG,MAAM,KAAK,CAAC;AACtB,OAAO,IAAI,MAAM,MAAM,CAAC;AACxB,OAAO,EAAE,SAAS,EAAE,MAAM,qBAAqB,CAAC;AAChD,OAAO,EAAE,SAAS,EAAE,MAAM,wBAAwB,CAAC;AAEnD,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;AAEd,eAAe,IAAI,IAAI,CAAC,KAAK,CAAC;IAC5B,KAAK,EAAE;QACL,IAAI,EAAE,EAAE;QACR,IAAI,EAAE,EAAU;QAChB,GAAG,EAAE,EAAE;QACP,IAAI,EAAE,EAAc;QACpB,QAAQ,EAAE,GAAG;QACb,OAAO,EAAE,EAAE;QACX,YAAY,EAAE,EAAE;QAChB,UAAU,EAAE,IAAyB;QACrC,aAAa,EAAE,EAAuC;QACtD,SAAS,EAAE,EAAiD;KAC7D;IACD,SAAS,EAAE;QACT,IAAI,YAAC,KAAK,EAAE,QAAQ;YACjB,wBAAU,EAAE,wBAAU,EAAE,uBAAS,EAAE,wBAAU,CAAa;QAC7D,CAAC;QACD,UAAU;QACV,WAAW,YAAC,KAAK,EAAE,KAAa;YAC9B,KAAK,CAAC,QAAQ,GAAG,KAAK,CAAC;QACzB,CAAC;QACD,SAAS;QACT,UAAU,YAAC,KAAK,EAAE,OAAe;YAC/B,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;QAC1B,CAAC;QACD,OAAO;QACP,YAAY,YAAC,KAAK,EAAE,MAAc;YAChC,IAAI,MAAM,CAAC,OAAO,EAAE;gBAClB,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;aACzC;iBAAM;gBACL,KAAK,CAAC,YAAY,GAAG,MAAM,CAAC;aAC7B;QACH,CAAC;QACD,OAAO;QACP,UAAU,YAAC,KAAK,EAAE,OAAgE;YAChF,KAAK,CAAC,UAAU,GAAG,OAAO,CAAC;QAC7B,CAAC;QACD,SAAS;QACT,eAAe,YAAC,KAAK,EAAE,OAAkD;;YACvE,KAAK,CAAC,aAAa,wBAAQ,KAAK,CAAC,aAAa,eAAG,OAAO,CAAC,IAAI,IAAG,OAAO,CAAC,OAAO,MAAE,CAAC;QACpF,CAAC;QACD,SAAS;QACT,iBAAiB,YAAC,KAAK;YACrB,KAAK,CAAC,aAAa,GAAG,EAAE,CAAC;QAC3B,CAAC;QACD,SAAS;QACT,YAAY,YAAC,KAAK,EAAE,QAAgD;;YAClE,KAAK,CAAC,SAAS,wBAAQ,KAAK,CAAC,SAAS,eAAG,QAAQ,CAAC,IAAI,IAAG,EAAE,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,MAAE,CAAC;QAC9F,CAAC;KACF;IACD,OAAO,EAAE;QACP,MAAM;QACA,IAAI,YAAC,EAAoB;gBAAlB,kBAAM,EAAE,sBAAQ;;;;;;iCAEvB,MAAM,CAAC,OAAO,EAAd,wBAAc;4BAEU,qBAAM,OAAO,CAAC,GAAG,CAAC;oCAC1C,IAAI,OAAO,CAAS,UAAA,OAAO,IAAI,OAAA,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,EAAtC,CAAsC,CAAC;oCACtE,IAAI,OAAO,CAAO,UAAA,OAAO,IAAI,OAAA,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,EAAzC,CAAyC,CAAC;oCACvE,IAAI,OAAO,CAAS,UAAA,OAAO,IAAI,OAAA,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,kBAAkB,CAAC,OAAO,CAAC,EAAjD,CAAiD,CAAC;oCACjF,IAAI,OAAO,CAAW,UAAA,OAAO,IAAI,OAAA,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,mBAAmB,CAAC,OAAO,CAAC,EAAlD,CAAkD,CAAC;iCACrF,CAAC,EAAA;;4BANF,UAAU;4BACV,cAKE,EALD,YAAI,EAAE,YAAI,EAAE,WAAG,EAAE,YAAI,CAKnB;4BACH,QAAQ,CAAC,cAAc,CAAC,CAAC;;;4BAEzB,UAAU;4BACV,IAAI,GAAG,SAAS,CAAC,QAAQ,CAAC,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;4BACrC,qBAAM,KAAK,CAAC,gBAAgB,CAAC;qCACjC,IAAI,CAAC,UAAA,IAAI,IAAI,OAAA,IAAI,CAAC,IAAI,EAAE,EAAX,CAAW,CAAC;qCACzB,IAAI,CAAC,UAAC,MAAY,IAAK,OAAA,MAAM,EAAN,CAAM,CAAC,EAAA;;4BAFjC,IAAI,GAAG,SAE0B,CAAC;4BAC5B,qBAAM,KAAK,CAAC,eAAe,CAAC;qCAC/B,IAAI,CAAC,UAAA,IAAI,IAAI,OAAA,IAAI,CAAC,IAAI,EAAE,EAAX,CAAW,CAAC;qCACzB,IAAI,CAAC,UAAC,MAAwB,IAAK,OAAA,MAAM,CAAC,IAAI,EAAX,CAAW,CAAC,EAAA;;4BAFlD,GAAG,GAAG,SAE4C,CAAC;4BAC5C,qBAAM,KAAK,CAAC,gBAAgB,CAAC;qCACjC,IAAI,CAAC,UAAA,IAAI,IAAI,OAAA,IAAI,CAAC,IAAI,EAAE,EAAX,CAAW,CAAC;qCACzB,IAAI,CAAC,UAAC,MAAgB,IAAK,OAAA,MAAM,EAAN,CAAM,CAAC,EAAA;;4BAFrC,IAAI,GAAG,SAE8B,CAAC;;;4BAExC,IAAI,CAAC,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE;gCACtC,IAAI,GAAG,OAAO,CAAC;6BAChB;4BACD,MAAM,CAAC,MAAM,EAAE,CAAC,IAAI,EAAE,IAAI,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC,CAAC;;;;;SACzC;QACD,SAAS;QACT,YAAY,YAAC,EAAU;gBAAR,kBAAM;YACnB,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,eAAe,CAAC,OAAO,CAC3C,UAAC,IAAY,EAAE,MAAgB,EAAE,KAAe,EAAE,QAAkB;gBAClE,IAAM,OAAO,GAAG,MAAM,CAAC,GAAG,CAAC,UAAC,KAAK,EAAE,KAAK;oBACtC,OAAO;wBACL,KAAK,OAAA;wBACL,OAAO,EAAE,KAAK,CAAC,KAAK,CAAC;wBACrB,OAAO,EAAE,QAAQ,CAAC,KAAK,CAAC;qBACT,CAAC;gBACpB,CAAC,CAAC,CAAC;gBACH,IAAM,OAAO,GAAG,EAAE,IAAI,MAAA,EAAE,OAAO,SAAA,EAAE,CAAC;gBAClC,MAAM,CAAC,iBAAiB,EAAE,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC;YACpD,CAAC,CACF,CAAC;QACJ,CAAC;QACD,WAAW;QACX,UAAU,YAAC,EAAS,EAAE,IAAY;gBAArB,gBAAK;YAChB,IAAI,MAAM,CAAC,OAAO,EAAE;gBAClB,OAAO,YAAU,KAAK,CAAC,GAAG,SAAI,IAAI,SAAI,KAAK,CAAC,IAAM,CAAC;aACpD;iBAAM;gBACL,OAAU,KAAK,CAAC,GAAG,SAAI,IAAI,SAAI,KAAK,CAAC,IAAM,CAAC;aAC7C;QACH,CAAC;QACD,SAAS;QACH,UAAU,YAAC,EAAY,EAAE,IAAY;gBAAxB,sBAAQ;;;;;gCACZ,qBAAM,QAAQ,CAAC,YAAY,EAAE,IAAI,CAAC,EAAA;;4BAAzC,IAAI,GAAG,SAAkC;4BAClC,qBAAM,SAAS,CAAI,IAAI,cAAW,CAAC,EAAA;;4BAA1C,IAAI,GAAG,SAAmC;4BAC1C,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;4BACvD,KAAgB,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,EAAhC,KAAK,QAAA,EAAE,IAAI,QAAA,CAAsB;4BACtC,IAAI,GAAM,IAAI,SAAI,IAAM,CAAC;4BACzB,sBAAO,EAAE,IAAI,MAAA,EAAE,IAAI,MAAA,EAAE,KAAK,OAAA,EAAE,IAAI,MAAA,EAAE,EAAC;;;;SACpC;QACD,SAAS;QACH,SAAS,YAAC,EAAY,EAAE,IAAY;gBAAxB,sBAAQ;;;;;gCACX,qBAAM,QAAQ,CAAC,YAAY,EAAE,IAAI,CAAC,EAAA;;4BAAzC,IAAI,GAAG,SAAkC;4BACnC,qBAAM,SAAS,CAAI,IAAI,cAAW,CAAC,EAAA;;4BAAzC,GAAG,GAAG,SAAmC;4BACxC,KAAA,CAAA,KAAA,MAAM,CAAA,CAAC,MAAM,CAAA;4BAAC,qBAAM,SAAS,CAAC,EAAE,GAAG,KAAA,EAAE,IAAI,MAAA,EAAE,CAAC,EAAA;gCAAnD,sBAAO,cAAc,SAA8B,EAAC,EAAC;;;;SACtD;QACD,SAAS;QACT,QAAQ,YAAC,EAAE,EAAE,IAAY;YACvB,IAAI,MAAM,CAAC,OAAO,EAAE;gBAClB,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;aAC9C;iBAAM;gBACL,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aACnB;QACH,CAAC;KACF;CACF,CAAC,CAAC","sourcesContent":["import Vue from 'vue';\nimport Vuex from 'vuex';\nimport { fetchFile } from '@/helper/fetch-file';\nimport { renderMan } from '@/helper/render-man.ts';\n\nVue.use(Vuex);\n\nexport default new Vuex.Store({\n  state: {\n    lang: '',\n    dict: {} as Dict,\n    dir: '',\n    list: [] as string[],\n    navWidth: 200,\n    heading: '',\n    previewImage: '',\n    previewMan: null as null | PreviewMan,\n    searchResults: {} as { [key: string]: SearchResult[] },\n    positions: {} as { [key: string]: { x: number; y: number } },\n  },\n  mutations: {\n    init(state, initData) {\n      [state.lang, state.dict, state.dir, state.list] = initData;\n    },\n    // 保存导航栏宽度\n    setNavWidth(state, width: number) {\n      state.navWidth = width;\n    },\n    // 设置当前标题\n    setHeading(state, heading: string) {\n      state.heading = heading;\n    },\n    // 预览大图\n    previewImage(state, imgSrc: string) {\n      if (window.objects) {\n        window.objects.imageViewer.open(imgSrc);\n      } else {\n        state.previewImage = imgSrc;\n      }\n    },\n    // 预览手册\n    previewMan(state, payload: { name: string; heading: string; x: number; y: number }) {\n      state.previewMan = payload;\n    },\n    // 追加搜索结果\n    addSearchResult(state, payload: { name: string; results: SearchResult[] }) {\n      state.searchResults = { ...state.searchResults, [payload.name]: payload.results };\n    },\n    // 清空搜索结果\n    clearSearchResult(state) {\n      state.searchResults = {};\n    },\n    // 保存滚动位置\n    savePosition(state, position: { name: string; x: number; y: number }) {\n      state.positions = { ...state.positions, [position.name]: { x: position.x, y: position.y } };\n    },\n  },\n  actions: {\n    // 初始化\n    async init({ commit, dispatch }) {\n      let lang: string, dict: Dict, dir: string, list: string[];\n      if (window.objects) {\n        // 本地模式初始化\n        [lang, dict, dir, list] = await Promise.all([\n          new Promise<string>(resolve => window.objects.i18n.getLocale(resolve)),\n          new Promise<Dict>(resolve => window.objects.i18n.getSentences(resolve)),\n          new Promise<string>(resolve => window.objects.manual.getSystemManualDir(resolve)),\n          new Promise<string[]>(resolve => window.objects.manual.getSystemManualList(resolve)),\n        ]);\n        dispatch('listenSearch');\n      } else {\n        // 在线模式初始化\n        lang = navigator.language.replace('-', '_');\n        dict = await fetch('/api/dict.json')\n          .then(resp => resp.json())\n          .then((result: Dict) => result);\n        dir = await fetch('/api/dir.json')\n          .then(resp => resp.json())\n          .then((result: { path: string }) => result.path);\n        list = await fetch('/api/list.json')\n          .then(resp => resp.json())\n          .then((result: string[]) => result);\n      }\n      if (!['zh_CN', 'en_US'].includes(lang)) {\n        lang = 'en_US';\n      }\n      commit('init', [lang, dict, dir, list]);\n    },\n    // 监听搜索事件\n    listenSearch({ commit }) {\n      window.objects.search.onContentResult.connect(\n        (name: string, titles: string[], heads: string[], contents: string[]) => {\n          const results = titles.map((title, index) => {\n            return {\n              title,\n              heading: heads[index],\n              content: contents[index],\n            } as SearchResult;\n          });\n          const payload = { name, results };\n          commit('addSearchResult', Object.freeze(payload));\n        },\n      );\n    },\n    // 获取应用目录路径\n    getAppPath({ state }, name: string) {\n      if (window.objects) {\n        return `file://${state.dir}/${name}/${state.lang}`;\n      } else {\n        return `${state.dir}/${name}/${state.lang}`;\n      }\n    },\n    // 获取应用信息\n    async getAppInfo({ dispatch }, name: string) {\n      const path = await dispatch('getAppPath', name);\n      const text = await fetchFile(`${path}/index.md`);\n      const header = text.slice('# '.length, text.indexOf('\\n'));\n      let [title, icon] = header.split('|');\n      icon = `${path}/${icon}`;\n      return { name, icon, title, path };\n    },\n    // 渲染md文件\n    async renderApp({ dispatch }, name: string) {\n      const path = await dispatch('getAppPath', name);\n      const raw = await fetchFile(`${path}/index.md`);\n      return Object.freeze(await renderMan({ raw, path }));\n    },\n    // 打开外部链接\n    openLink({}, link: string) {\n      if (window.objects) {\n        window.objects.manual.openExternalLink(link);\n      } else {\n        window.open(link);\n      }\n    },\n  },\n});\n\nexport interface Dict {\n  [key: string]: string;\n}\n\nexport interface PreviewMan {\n  name: string;\n  heading: string;\n  x: number;\n  y: number;\n}\n\nexport interface SearchResult {\n  title: string;\n  heading: string;\n  content: string;\n}\n"]}]}